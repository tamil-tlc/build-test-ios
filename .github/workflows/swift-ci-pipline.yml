name: swift ci

on:
 push:
  branches: [ "main", "dev", "qa" ]
 pull_request:
  branches: [ "main", "dev", "qa", "feature/*", "release/*" ]

jobs:
 lint:
  runs-on: macos-latest

  steps:
   - name: checkout the code
     uses: actions/checkout@v4

   - name: install swiftlint
     run: brew install swiftlint

   - name: run swiftlint
     run: swiftlint || echo "linting issue is there"


 unit-test:
   needs: lint
   runs-on: macos-latest

   steps:
    - name: checkout the code
      uses: actions/checkout@v4

    - name: Select Xcode Version
      run: sudo xcode-select -s /Applications/Xcode_15.4.app

    - name: Show available simulators (debugging)
      run: xcrun xctrace list devices

    - name: run unit test
      run: |
        xcodebuild test \ || echo "xcode test case fail"
        -project build-test-ios/build-test-ios.xcodeproj \ || echo "project derectory faild"
        -scheme build-test-ios \ || echo "scheme not found"

 build:
  needs: [lint, unit-test]
  runs-on: macos-latest

  steps:
   - name: checkout the code
     uses: actions/checkout@v4

   - name: select xcode version
     run: sudo xcode-select-s/applications/xcode_15.4.app

   - name: built the swift code
     run: |
       xcodebuild build \
       -project built-test-ios/build-test-ios.xcodeproj \
       -scheme built-test-ios \
       -destination platform=iOS simulator,name=iphone 15,os=17.4
        
