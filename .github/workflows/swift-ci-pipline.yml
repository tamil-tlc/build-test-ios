name: swift ci

on:
 push:
  branches: [ "main", "dev", "qa" ]
 pull_request:
  branches: [ "main", "dev", "qa", "feature/*", "release/*" ]

jobs:
 lint:
  runs-on: macos-latest

  steps:
   - name: checkout the code
     uses: actions/checkout@v4

   - name: install swiftlint
     run: brew install swiftlint

   - name: run swiftlint
     run: swiftlint 


 test:
    needs: lint
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Xcode 16
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '16.1.0'
        
    - name: Build and Test
      run: |
        xcodebuild test \
          -project build-test-ios.xcodeproj \
          -scheme build-test-ios \
          -resultBundlePath TestResults \
          CODE_SIGNING_REQUIRED=NO
          
    - name: Upload Test Results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results
        path: TestResults.xcresult

 build:
  needs: [lint, test]
  runs-on: macos-latest

  steps:
   - name: checkout the code
     uses: actions/checkout@v4

   - name: Select Xcode Version
     run: sudo xcode-select -s /Applications/Xcode_15.4.app

   - name: built the swift code
     run: |
          xcodebuild clean build \
            -project build-test-ios.xcodeproj \
            -scheme build-test-ios \
            -destination "platform=iOS Simulator,name=iPhone 15,OS=17.4"
        
